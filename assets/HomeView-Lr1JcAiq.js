import{d as V,u as S,a as z,c as k,_ as q,b as M,e as w,o as r,w as _,f as h,m as L,g as l,r as H,h as E,i as v,t as n,j as D,k as y,l as e,n as I,p as R,q as j,s as U,v as i,x as B,F as T,y as N,z as Q,A as O,B as W}from"./index-CnDOF7Do.js";import{_ as G,u as J}from"./courses-BUTPmGTd.js";import{u as K}from"./orders-BgooqpD3.js";import{_ as X,a as Y,b as Z,c as ee,d as te}from"./BCard.vue_vue_type_script_setup_true_lang-BAaV9t2h-CIFWF0FW.js";const se=V({__name:"BBadge",props:{dotIndicator:{type:Boolean,default:!1},pill:{type:Boolean,default:!1},placement:{default:void 0},tag:{default:"span"},active:{type:Boolean,default:void 0},activeClass:{default:void 0},disabled:{type:Boolean,default:void 0},exactActiveClass:{default:void 0},href:{default:void 0},icon:{type:Boolean,default:void 0},noRel:{type:Boolean},opacity:{default:void 0},opacityHover:{default:void 0},prefetch:{type:Boolean},prefetchOn:{},noPrefetch:{type:Boolean},prefetchedClass:{},rel:{default:void 0},replace:{type:Boolean,default:void 0},routerComponentName:{default:void 0},stretched:{type:Boolean,default:!1},target:{default:void 0},to:{default:void 0},underlineOffset:{default:void 0},underlineOffsetHover:{default:void 0},underlineOpacity:{default:void 0},underlineOpacityHover:{default:void 0},underlineVariant:{default:void 0},variant:{default:"secondary"},bgVariant:{default:null},textVariant:{default:null}},setup(m){const t=S(m,"BBadge"),{computedLink:a,computedLinkProps:g}=z(t,["active","activeClass","append","disabled","href","rel","replace","routerComponentName","target","to","opacity","opacityHover","underlineVariant","underlineOffset","underlineOffsetHover","underlineOpacity","underlineOpacityHover","icon"]),C=k(()=>a.value?q:t.tag),b=k(()=>{const c=t.placement??(t.dotIndicator?"top-end":void 0);return["position-absolute","translate-middle",{"start-0 top-0":c==="top-start","start-0 top-50":c==="start","start-0 top-100":c==="bottom-start","start-50 top-0":c==="top","start-50 top-100":c==="bottom","start-100 top-0":c==="top-end","start-100 top-50":c==="end","start-100 top-100":c==="bottom-end"}]}),d=M(t),f=k(()=>[d.value,t.placement!==void 0||t.dotIndicator===!0?b.value:void 0,{active:t.active,disabled:t.disabled,"rounded-pill":t.pill,"p-2 border border-light rounded-circle":t.dotIndicator,"text-decoration-none":a.value}]);return(c,x)=>(r(),w(E(C.value),L({class:["badge",f.value]},l(g)),{default:_(()=>[h(G,L({skip:l(t).dotIndicator!==!0,tag:"span"},l(t).dotIndicator?{class:"visually-hidden"}:{}),{default:_(()=>[H(c.$slots,"default")]),_:3},16,["skip"])]),_:3},16,["class"]))}}),oe=V({__name:"BCardText",props:{tag:{default:"p"},text:{default:void 0}},setup(m){const t=S(m,"BCardText");return(a,g)=>(r(),w(E(l(t).tag),{class:"card-text"},{default:_(()=>[H(a.$slots,"default",{},()=>[v(n(l(t).text),1)])]),_:3}))}}),ae={name:"CourseCard",components:{BCard:te,BCardImg:ee,BCardBody:Z,BCardTitle:Y,BCardText:oe,BBadge:se,BProgressBar:X},props:{course:{type:Object,required:!0}},setup(m){return{inscriptionPercentage:k(()=>m.course.cupos===0?0:Math.round(m.course.inscritos/m.course.cupos*100)),formatPrice:a=>new Intl.NumberFormat("es-CL",{style:"decimal",minimumFractionDigits:0}).format(a)}}},re={class:"d-flex justify-content-between align-items-start gap-2 mb-2"},ne={class:"mt-auto"},le={class:"text-muted"},ie=["disabled"];function de(m,s,t,a,g,C){const b=y("BCardImg"),d=y("BCardTitle"),f=y("BBadge"),c=y("BCardText"),x=y("BProgressBar"),P=y("BCardBody"),$=y("BCard");return r(),w($,{class:"course-card h-100"},{default:_(()=>[h(b,{src:t.course.img,alt:t.course.nombre,top:"",class:"course-image"},null,8,["src","alt"]),h(P,{class:"d-flex flex-column"},{default:_(()=>[e("div",re,[h(d,{class:"mb-0"},{default:_(()=>[v(n(t.course.nombre),1)]),_:1}),h(f,{variant:t.course.estado?"success":"secondary"},{default:_(()=>[v(n(t.course.estado?"Disponible":"Inactivo"),1)]),_:1},8,["variant"])]),h(c,{class:"flex-grow-1"},{default:_(()=>[s[1]||(s[1]=e("strong",null,"Código:",-1)),v(" "+n(t.course.codigo),1),s[2]||(s[2]=e("br",null,null,-1)),s[3]||(s[3]=e("strong",null,"Descripción:",-1)),v(" "+n(t.course.descripcion),1),s[4]||(s[4]=e("br",null,null,-1)),s[5]||(s[5]=e("strong",null,"Duración:",-1)),v(" "+n(t.course.duracion),1),s[6]||(s[6]=e("br",null,null,-1)),s[7]||(s[7]=e("strong",null,"Precio:",-1)),v(" $"+n(a.formatPrice(t.course.precio)),1),s[8]||(s[8]=e("br",null,null,-1)),s[9]||(s[9]=e("strong",null,"Cupos:",-1)),v(" "+n(t.course.cupos),1),s[10]||(s[10]=e("br",null,null,-1)),s[11]||(s[11]=e("strong",null,"Inscritos:",-1)),v(" "+n(t.course.inscritos),1)]),_:1}),e("div",ne,[h(x,{value:a.inscriptionPercentage,max:100,class:"mb-2",height:"8px"},null,8,["value"]),e("small",le,n(a.inscriptionPercentage)+"% de cupos ocupados ",1),e("button",{class:"enroll-btn",disabled:!t.course.estado,onClick:s[0]||(s[0]=A=>m.$emit("enroll",t.course))},n(t.course.estado?"Agregar al carrito":"No disponible"),9,ie)])]),_:1})]),_:1})}const ue=D(ae,[["render",de],["__scopeId","data-v-5a856eb2"]]),ce={class:"home-container"},pe={class:"content-wrapper"},me={key:0,class:"loading-section"},ve={key:1,class:"error-section"},fe={class:"error-content"},_e={key:2},ge={class:"filters-section"},Ce={class:"filters-container"},be={class:"filter-buttons"},ye=["onClick"],Be={key:0,class:"cart-section"},he={class:"cart-header"},xe={class:"badge bg-primary rounded-pill"},ke={key:0,class:"cart-helper"},Ie={key:1,class:"cart-list"},we={class:"mb-0 text-muted"},Pe={class:"cart-item-actions"},$e={class:"fw-semibold"},Te=["onClick"],Ne={class:"cart-actions"},Ae={class:"mb-0"},Le={class:"d-flex gap-2 flex-column flex-sm-row"},Oe=["disabled"],Ve=["disabled"],Se={key:0,class:"spinner-border spinner-border-sm me-2"},He={key:1,class:"courses-grid"},Ee={key:2,class:"no-courses-section"},De={class:"no-courses-content"},Fe={class:"no-courses-text"},ze={__name:"HomeView",setup(m){const s=J(),t=Q(),a=K(),g=W(),C=I("all"),b=I(null),d=I(null),f=I(!1),c=[{text:"Todos",value:"all"},{text:"Solo Activos",value:"active"}],x=k(()=>C.value==="active"?s.activeCourses:s.allCourses);R(async()=>{const p=await s.initCoursesListener();typeof p=="function"&&(b.value=p)}),j(()=>{typeof b.value=="function"&&b.value()}),U(()=>t.isAuthenticated,async p=>{if(p)try{await a.ensureCart(),await a.fetchUserCourses()}catch{d.value={type:"danger",text:"No se pudo preparar tu carrito."}}else d.value=null},{immediate:!0});const P=async p=>{if(!t.isAuthenticated){g.push({name:"login",query:{redirect:g.currentRoute.value.fullPath}});return}const o=await a.addCourseToCart(p);o?.success?o.duplicated?d.value={type:"info",text:"Este curso ya está en tu carrito."}:d.value={type:"success",text:"Curso agregado al carrito."}:d.value={type:"danger",text:o?.error||"No se pudo agregar el curso."}},$=async()=>{if(!a.hasItemsInCart){d.value={type:"info",text:"Agrega cursos antes de finalizar."};return}f.value=!0;const p=await a.checkoutCart();f.value=!1,p?.success?(d.value={type:"success",text:'Compra finalizada. Revisa "Mis Cursos".'},g.push({name:"my-courses"})):d.value={type:"danger",text:p?.error||"No se pudo completar la compra."}},A=async p=>{await a.removeCourseFromCart(p)};return(p,o)=>(r(),i("div",ce,[o[9]||(o[9]=e("div",{class:"hero-section"},[e("div",{class:"hero-content"},[e("h1",{class:"hero-title"},"Bienvenido a AdWeb Online"),e("p",{class:"hero-subtitle"}," Plataforma de cursos de programación y desarrollo web ")])],-1)),e("div",pe,[l(s).isLoading?(r(),i("div",me,[...o[2]||(o[2]=[e("div",{class:"loading-spinner-large"},null,-1),e("p",{class:"loading-text"},"Cargando cursos...",-1)])])):B("",!0),l(s).getError?(r(),i("div",ve,[e("div",fe,[e("div",null,[o[3]||(o[3]=e("h4",null,"Error al cargar los cursos",-1)),e("p",null,n(l(s).getError),1)])])])):B("",!0),!l(s).isLoading&&!l(s).getError?(r(),i("div",_e,[e("div",ge,[e("div",Ce,[o[4]||(o[4]=e("h3",{class:"filters-title"}," Filtrar cursos: ",-1)),e("div",be,[(r(),i(T,null,N(c,u=>e("button",{key:u.value,class:O(["filter-btn",{active:C.value===u.value}]),onClick:F=>C.value=u.value},n(u.text),11,ye)),64))])])]),l(t).isAuthenticated?(r(),i("div",Be,[e("div",he,[o[5]||(o[5]=e("h3",null,"Tu carrito",-1)),e("span",xe,n(l(a).cartItemsCount)+" curso(s) ",1)]),l(a).hasItemsInCart?(r(),i("ul",Ie,[(r(!0),i(T,null,N(l(a).cartItems,u=>(r(),i("li",{key:u.courseId,class:"cart-item"},[e("div",null,[e("strong",null,n(u.nombre),1),e("p",we,n(u.codigo),1)]),e("div",Pe,[e("span",$e,"$"+n(u.precio.toLocaleString("es-CL")),1),e("button",{class:"btn btn-link btn-sm text-danger",onClick:F=>A(u.courseId)}," Quitar ",8,Te)])]))),128))])):(r(),i("p",ke,' Aún no agregas cursos. Pulsa "Inscribirme" para sumarlos aquí. ')),e("div",Ne,[e("div",null,[o[6]||(o[6]=e("p",{class:"mb-1 text-muted"},"Total estimado",-1)),e("h4",Ae,"$"+n(l(a).cartTotal.toLocaleString("es-CL")),1)]),e("div",Le,[e("button",{class:"btn btn-outline-secondary",type:"button",onClick:o[0]||(o[0]=u=>l(a).clearCart()),disabled:!l(a).hasItemsInCart}," Vaciar ",8,Oe),e("button",{class:"btn btn-success",type:"button",onClick:$,disabled:f.value||!l(a).hasItemsInCart},[f.value?(r(),i("span",Se)):B("",!0),o[7]||(o[7]=v(" Finalizar compra ",-1))],8,Ve)])]),d.value?(r(),i("div",{key:2,class:O(["alert mt-3",`alert-${d.value.type}`])},n(d.value.text),3)):B("",!0)])):B("",!0),x.value.length>0?(r(),i("div",He,[(r(!0),i(T,null,N(x.value,u=>(r(),w(ue,{key:u.id,course:u,onEnroll:P},null,8,["course"]))),128))])):(r(),i("div",Ee,[e("div",De,[o[8]||(o[8]=e("h4",{class:"no-courses-title"},"No hay cursos disponibles",-1)),e("p",Fe,n(C.value==="active"?"No hay cursos activos en este momento.":"No se encontraron cursos."),1),l(t).isAdmin?(r(),i("button",{key:0,class:"add-course-btn",onClick:o[1]||(o[1]=u=>p.$router.push("/admin"))}," Agregar Cursos ")):B("",!0)])]))])):B("",!0)])]))}},Ue=D(ze,[["__scopeId","data-v-03d5101d"]]);export{Ue as default};
